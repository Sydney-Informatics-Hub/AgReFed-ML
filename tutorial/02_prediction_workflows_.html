<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>02 Prediction Workflows</title>
  <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style>
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->

  <style>
    .mermaid {
      text-align: center;
      margin: 20px 0;
    }
    
    pre code.language-mermaid {
      background: transparent !important;
      border: none !important;
      padding: 0 !important;
    }
    
    pre.mermaid {
      background: transparent !important;
      border: none !important;
      text-align: center;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: 'default',
      securityLevel: 'loose',
      fontFamily: 'Arial, sans-serif'
    });
  </script>
</head>
<body>

<div id="navigation-sidebar" style="
    position: fixed;
    top: 0;
    left: 0;
    width: 280px;
    height: 100vh;
    background: #f8f9fa;
    border-right: 1px solid #a2a9b1;
    box-shadow: 2px 0 5px rgba(0,0,0,0.1);
    z-index: 1000;
    overflow-y: auto;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Liberation Sans', sans-serif;
    font-size: 14px;
    line-height: 1.6;
">
    <div style="
        background: #eaecf0;
        padding: 15px 20px;
        border-bottom: 1px solid #a2a9b1;
        position: sticky;
        top: 0;
        z-index: 1001;
    ">
        <h3 style="
            margin: 0;
            font-size: 16px;
            font-weight: 600;
            color: #000;
            display: flex;
            align-items: center;
            gap: 8px;
        ">
            üìö <span>Contents</span>
        </h3>
    </div>
    
    <nav style="padding: 15px 0;">
        <!-- Home/Overview Link -->
        <div style="padding: 0 0 10px 0; border-bottom: 1px solid #eee; margin-bottom: 10px;">
            <a href="index.html" style="
                display: flex;
                align-items: center;
                gap: 8px;
                padding: 8px 20px;
                color: #0645ad;
                text-decoration: none;
                border-left: 4px solid transparent;
                transition: all 0.2s ease;
                font-weight: 500;
            " 
            onmouseover="
                this.style.background='#eaf3ff'; 
                this.style.borderLeft='4px solid #0645ad';
                this.style.color='#0b3c5d';
            " 
            onmouseout="
                this.style.background='transparent'; 
                this.style.borderLeft='4px solid transparent';
                this.style.color='#0645ad';
            ">
                <span style="font-size: 16px;">üè†</span>
                <span>Overview</span>
            </a>
        </div>
        
        <ul style="
            list-style: none;
            margin: 0;
            padding: 0;
        ">
            <li style="margin: 0;">
                <a href="01_notebook_based_workflows_.html" style="
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    padding: 10px 20px;
                    color: #0645ad;
                    text-decoration: none;
                    border-left: 4px solid transparent;
                    transition: all 0.2s ease;
                " 
                onmouseover="
                    this.style.background='#eaf3ff'; 
                    this.style.borderLeft='4px solid #0645ad';
                    this.style.color='#0b3c5d';
                " 
                onmouseout="
                    this.style.background='transparent'; 
                    this.style.borderLeft='4px solid transparent';
                    this.style.color='#0645ad';
                ">
                    <span style="
                        background: #f0f0f0;
                        color: #555;
                        border-radius: 12px;
                        padding: 2px 8px;
                        font-size: 12px;
                        font-weight: 500;
                        min-width: 20px;
                        text-align: center;
                    ">1</span>
                    <span style="flex: 1;">Notebook-Based Workflows</span>
                </a>
            </li>
            <li style="
                margin: 0;
                background: #0645ad;
                background: linear-gradient(90deg, #0645ad 0%, #0b7ec8 100%);
                border-left: 4px solid #0645ad;
            ">
                <div style="
                    padding: 10px 20px;
                    color: white;
                    font-weight: 600;
                    display: flex;
                    align-items: center;
                    gap: 8px;
                ">
                    <span style="
                        background: rgba(255,255,255,0.2);
                        color: white;
                        border-radius: 12px;
                        padding: 2px 8px;
                        font-size: 12px;
                        font-weight: 500;
                        min-width: 20px;
                        text-align: center;
                    ">2</span>
                    <span style="flex: 1;">Prediction Workflows</span>
                    <span style="color: #ffd700;">‚óè</span>
                </div>
            </li>
            <li style="margin: 0;">
                <a href="03_data_preprocessing_pipeline_.html" style="
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    padding: 10px 20px;
                    color: #0645ad;
                    text-decoration: none;
                    border-left: 4px solid transparent;
                    transition: all 0.2s ease;
                " 
                onmouseover="
                    this.style.background='#eaf3ff'; 
                    this.style.borderLeft='4px solid #0645ad';
                    this.style.color='#0b3c5d';
                " 
                onmouseout="
                    this.style.background='transparent'; 
                    this.style.borderLeft='4px solid transparent';
                    this.style.color='#0645ad';
                ">
                    <span style="
                        background: #f0f0f0;
                        color: #555;
                        border-radius: 12px;
                        padding: 2px 8px;
                        font-size: 12px;
                        font-weight: 500;
                        min-width: 20px;
                        text-align: center;
                    ">3</span>
                    <span style="flex: 1;">Data Preprocessing Pipeline</span>
                </a>
            </li>
            <li style="margin: 0;">
                <a href="04_mean_function_models___.html" style="
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    padding: 10px 20px;
                    color: #0645ad;
                    text-decoration: none;
                    border-left: 4px solid transparent;
                    transition: all 0.2s ease;
                " 
                onmouseover="
                    this.style.background='#eaf3ff'; 
                    this.style.borderLeft='4px solid #0645ad';
                    this.style.color='#0b3c5d';
                " 
                onmouseout="
                    this.style.background='transparent'; 
                    this.style.borderLeft='4px solid transparent';
                    this.style.color='#0645ad';
                ">
                    <span style="
                        background: #f0f0f0;
                        color: #555;
                        border-radius: 12px;
                        padding: 2px 8px;
                        font-size: 12px;
                        font-weight: 500;
                        min-width: 20px;
                        text-align: center;
                    ">4</span>
                    <span style="flex: 1;">Mean Function Models</span>
                </a>
            </li>
            <li style="margin: 0;">
                <a href="05_gaussian_process_models_.html" style="
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    padding: 10px 20px;
                    color: #0645ad;
                    text-decoration: none;
                    border-left: 4px solid transparent;
                    transition: all 0.2s ease;
                " 
                onmouseover="
                    this.style.background='#eaf3ff'; 
                    this.style.borderLeft='4px solid #0645ad';
                    this.style.color='#0b3c5d';
                " 
                onmouseout="
                    this.style.background='transparent'; 
                    this.style.borderLeft='4px solid transparent';
                    this.style.color='#0645ad';
                ">
                    <span style="
                        background: #f0f0f0;
                        color: #555;
                        border-radius: 12px;
                        padding: 2px 8px;
                        font-size: 12px;
                        font-weight: 500;
                        min-width: 20px;
                        text-align: center;
                    ">5</span>
                    <span style="flex: 1;">Gaussian Process Models</span>
                </a>
            </li>
            <li style="margin: 0;">
                <a href="06_uncertainty_quantification_system_.html" style="
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    padding: 10px 20px;
                    color: #0645ad;
                    text-decoration: none;
                    border-left: 4px solid transparent;
                    transition: all 0.2s ease;
                " 
                onmouseover="
                    this.style.background='#eaf3ff'; 
                    this.style.borderLeft='4px solid #0645ad';
                    this.style.color='#0b3c5d';
                " 
                onmouseout="
                    this.style.background='transparent'; 
                    this.style.borderLeft='4px solid transparent';
                    this.style.color='#0645ad';
                ">
                    <span style="
                        background: #f0f0f0;
                        color: #555;
                        border-radius: 12px;
                        padding: 2px 8px;
                        font-size: 12px;
                        font-weight: 500;
                        min-width: 20px;
                        text-align: center;
                    ">6</span>
                    <span style="flex: 1;">Uncertainty Quantification System</span>
                </a>
            </li>
            <li style="margin: 0;">
                <a href="07_spatial_temporal_modeling_framework_.html" style="
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    padding: 10px 20px;
                    color: #0645ad;
                    text-decoration: none;
                    border-left: 4px solid transparent;
                    transition: all 0.2s ease;
                " 
                onmouseover="
                    this.style.background='#eaf3ff'; 
                    this.style.borderLeft='4px solid #0645ad';
                    this.style.color='#0b3c5d';
                " 
                onmouseout="
                    this.style.background='transparent'; 
                    this.style.borderLeft='4px solid transparent';
                    this.style.color='#0645ad';
                ">
                    <span style="
                        background: #f0f0f0;
                        color: #555;
                        border-radius: 12px;
                        padding: 2px 8px;
                        font-size: 12px;
                        font-weight: 500;
                        min-width: 20px;
                        text-align: center;
                    ">7</span>
                    <span style="flex: 1;">Spatial-Temporal Modeling Framework</span>
                </a>
            </li>
            <li style="margin: 0;">
                <a href="08_synthetic_data_generation_.html" style="
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    padding: 10px 20px;
                    color: #0645ad;
                    text-decoration: none;
                    border-left: 4px solid transparent;
                    transition: all 0.2s ease;
                " 
                onmouseover="
                    this.style.background='#eaf3ff'; 
                    this.style.borderLeft='4px solid #0645ad';
                    this.style.color='#0b3c5d';
                " 
                onmouseout="
                    this.style.background='transparent'; 
                    this.style.borderLeft='4px solid transparent';
                    this.style.color='#0645ad';
                ">
                    <span style="
                        background: #f0f0f0;
                        color: #555;
                        border-radius: 12px;
                        padding: 2px 8px;
                        font-size: 12px;
                        font-weight: 500;
                        min-width: 20px;
                        text-align: center;
                    ">8</span>
                    <span style="flex: 1;">Synthetic Data Generation</span>
                </a>
            </li>
            <li style="margin: 0;">
                <a href="09_model_evaluation_and_cross_validation_.html" style="
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    padding: 10px 20px;
                    color: #0645ad;
                    text-decoration: none;
                    border-left: 4px solid transparent;
                    transition: all 0.2s ease;
                " 
                onmouseover="
                    this.style.background='#eaf3ff'; 
                    this.style.borderLeft='4px solid #0645ad';
                    this.style.color='#0b3c5d';
                " 
                onmouseout="
                    this.style.background='transparent'; 
                    this.style.borderLeft='4px solid transparent';
                    this.style.color='#0645ad';
                ">
                    <span style="
                        background: #f0f0f0;
                        color: #555;
                        border-radius: 12px;
                        padding: 2px 8px;
                        font-size: 12px;
                        font-weight: 500;
                        min-width: 20px;
                        text-align: center;
                    ">9</span>
                    <span style="flex: 1;">Model Evaluation and Cross-Validation</span>
                </a>
            </li>
        </ul>
    </nav>
</div>

<style>
/* Force content spacing with aggressive selectors */
html, body {
    margin: 0 !important;
    padding: 0 !important;
}

body {
    padding-left: 340px !important;  /* Sidebar (280px) + generous padding (60px) */
    padding-right: 60px !important;  /* Matching right padding */
    margin: 0 !important;
    box-sizing: border-box !important;
}

/* Target all possible content containers */
body > *, 
main, article, section, .content, 
#content, .main-content, .page-content,
body > div, body > header, body > nav:not(#navigation-sidebar) {
    margin-left: 0 !important;
    padding-left: 0 !important;
    max-width: none !important;
}

/* Ensure headings have proper spacing from sidebar */
h1, h2, h3, h4, h5, h6 {
    margin-top: 2em !important;
    margin-bottom: 1em !important;
    line-height: 1.3 !important;
}

/* Better paragraph and content spacing */
p, div, ul, ol, blockquote, pre {
    margin-bottom: 1.5em !important;
    line-height: 1.6 !important;
}

/* Handle wide content like code blocks and tables */
pre, table, .mermaid, code {
    max-width: calc(100vw - 420px) !important; /* Account for all spacing */
    overflow-x: auto !important;
    margin: 1.5em 0 !important;
}

/* Responsive design */
@media (max-width: 1200px) {
    body {
        padding-left: 320px !important; /* Slightly less padding on medium screens */
        padding-right: 40px !important;
    }
    
    pre, table, .mermaid, code {
        max-width: calc(100vw - 380px) !important;
    }
}

@media (max-width: 768px) {
    #navigation-sidebar {
        width: 250px;
    }
    body {
        padding-left: 290px !important; /* Sidebar (250px) + padding (40px) */
        padding-right: 30px !important;
    }
    
    pre, table, .mermaid, code {
        max-width: calc(100vw - 340px) !important;
    }
}

@media (max-width: 600px) {
    #navigation-sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
    }
    #navigation-sidebar:hover,
    #navigation-sidebar:focus-within {
        transform: translateX(0);
    }
    body {
        padding-left: 20px !important;
        padding-right: 20px !important;
    }
    
    pre, table, .mermaid, code {
        max-width: calc(100vw - 60px) !important;
    }
    
    /* Mobile menu button */
    #navigation-sidebar::before {
        content: "‚ò∞ Contents";
        position: fixed;
        top: 10px;
        left: 10px;
        background: #0645ad;
        color: white;
        padding: 8px 12px;
        border-radius: 4px;
        font-size: 14px;
        cursor: pointer;
        z-index: 1002;
        box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
}

/* Print styles */
@media print {
    #navigation-sidebar {
        display: none !important;
    }
    body {
        padding-left: 2cm !important;
        padding-right: 2cm !important;
    }
    
    pre, table, .mermaid {
        max-width: 100% !important;
    }
}
</style>

<header id="title-block-header">
<h1 class="title">02 Prediction Workflows</h1>
</header>
<h1 id="chapter-2-prediction-workflows">Chapter 2: Prediction Workflows</h1>
<p>Now that you‚Äôve learned how <a href="01_notebook_based_workflows_.html">Notebook-Based Workflows</a> provide structured, step-by-step guides for agricultural machine learning, it‚Äôs time to explore the engine that powers these workflows: <strong>Prediction Workflows</strong>.</p>
<p>Think of this relationship like a cookbook and kitchen equipment. The notebook-based workflows are your recipe cards that guide you through each step, while prediction workflows are the specialized kitchen tools - your food processor, stand mixer, and precision thermometer - that actually do the heavy lifting to create your final dish.</p>
<h2 id="what-problem-do-prediction-workflows-solve">What Problem Do Prediction Workflows Solve?</h2>
<p>Imagine you‚Äôre a photographer with three different assignments:</p>
<ol type="1">
<li><strong>Portrait Photography</strong>: Taking a single perfect headshot of someone</li>
<li><strong>Before-and-After Photography</strong>: Documenting a home renovation over 6 months<br />
</li>
<li><strong>Time-lapse Photography</strong>: Capturing a flower blooming over several days</li>
</ol>
<p>Each scenario requires different camera settings, techniques, and equipment. You wouldn‚Äôt use the same approach for all three - and the same applies to soil modeling.</p>
<p>Agricultural researchers face similar diverse scenarios:</p>
<ul>
<li><strong>Mapping current soil carbon</strong>: Creating a snapshot of soil organic carbon levels across a farm right now</li>
<li><strong>Carbon accounting</strong>: Tracking how soil carbon changes over time for carbon credit programs</li>
<li><strong>Soil moisture monitoring</strong>: Predicting how soil moisture varies across space and time for irrigation planning</li>
</ul>
<p>Each of these scenarios needs a specialized approach, and that‚Äôs exactly what Prediction Workflows provide.</p>
<h2 id="the-three-types-of-prediction-workflows">The Three Types of Prediction Workflows</h2>
<p>Like having different camera modes, AgReFed-ML provides three specialized prediction workflows:</p>
<h3 id="static-soil-model---the-portrait-mode">1. <strong>Static Soil Model</strong> - The Portrait Mode</h3>
<p>This workflow creates detailed maps of soil properties for a single point in time. Perfect for: - Baseline soil mapping - Property assessment for land purchases - Creating reference maps for crop planning</p>
<h3 id="change-detection-model---the-before-and-after-mode">2. <strong>Change Detection Model</strong> - The Before-and-After Mode</h3>
<p>This workflow compares soil properties between two specific time periods. Ideal for: - Carbon accounting and verification - Monitoring soil health improvements - Assessing impact of management practices</p>
<h3 id="spatial-temporal-model---the-time-lapse-mode">3. <strong>Spatial-Temporal Model</strong> - The Time-lapse Mode</h3>
<p>This workflow models how soil properties vary continuously across both space and time. Great for: - Soil moisture forecasting - Dynamic nutrient management - Climate change impact studies</p>
<h2 id="how-to-use-prediction-workflows">How to Use Prediction Workflows</h2>
<p>Let‚Äôs walk through using each workflow type with practical examples.</p>
<h3 id="using-the-static-soil-model">Using the Static Soil Model</h3>
<p>Suppose you want to create a soil organic carbon map for a 500-hectare farm. Here‚Äôs how you‚Äôd configure and run the static workflow:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Configure the static soil model</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>settings <span class="op">=</span> {</span>
<span id="cb1-3"><a href="#cb1-3"></a>    <span class="st">&#39;model_function&#39;</span>: <span class="st">&#39;rf-gp&#39;</span>,  <span class="co"># Random Forest + Gaussian Process</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>    <span class="st">&#39;name_target&#39;</span>: <span class="st">&#39;organic_carbon&#39;</span>,</span>
<span id="cb1-5"><a href="#cb1-5"></a>    <span class="st">&#39;axistype&#39;</span>: <span class="st">&#39;vertical&#39;</span>,</span>
<span id="cb1-6"><a href="#cb1-6"></a>    <span class="st">&#39;integrate_block&#39;</span>: <span class="va">False</span>  <span class="co"># Use point predictions</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>}</span></code></pre></div>
<p>This tells the system you want to predict organic carbon using a combined Random Forest and Gaussian Process model, focusing on vertical (depth-based) soil mapping.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Run the static prediction workflow</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="im">from</span> soilmod_predict <span class="im">import</span> main</span>
<span id="cb2-3"><a href="#cb2-3"></a>main(<span class="st">&#39;settings_static_carbon.yaml&#39;</span>)</span></code></pre></div>
<p><strong>What you get</strong>: The system produces soil carbon maps for different depths (e.g., 0-10cm, 10-20cm, 20-30cm) along with uncertainty maps showing prediction confidence.</p>
<h3 id="using-the-change-detection-model">Using the Change Detection Model</h3>
<p>Now let‚Äôs say you need to verify carbon sequestration for a carbon credit program by comparing 2018 and 2023 measurements:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Configure the change detection model</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>settings <span class="op">=</span> {</span>
<span id="cb3-3"><a href="#cb3-3"></a>    <span class="st">&#39;model_function&#39;</span>: <span class="st">&#39;blr-gp&#39;</span>,  <span class="co"># Bayesian Linear Regression + GP</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>    <span class="st">&#39;name_target&#39;</span>: <span class="st">&#39;organic_carbon&#39;</span>,</span>
<span id="cb3-5"><a href="#cb3-5"></a>    <span class="st">&#39;list_t_pred&#39;</span>: [<span class="dv">2018</span>, <span class="dv">2023</span>],  <span class="co"># Two specific years</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>    <span class="st">&#39;axistype&#39;</span>: <span class="st">&#39;temporal&#39;</span></span>
<span id="cb3-7"><a href="#cb3-7"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># Run the change detection workflow  </span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="im">from</span> soilmod_predict_change <span class="im">import</span> main</span>
<span id="cb4-3"><a href="#cb4-3"></a>main(<span class="st">&#39;settings_carbon_change.yaml&#39;</span>)</span></code></pre></div>
<p><strong>What you get</strong>: Maps showing carbon levels for both years, plus a change map highlighting areas of carbon gain or loss, complete with statistical significance testing.</p>
<h3 id="using-the-spatial-temporal-model">Using the Spatial-Temporal Model</h3>
<p>For dynamic soil moisture management across a growing season:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Configure spatial-temporal model</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>settings <span class="op">=</span> {</span>
<span id="cb5-3"><a href="#cb5-3"></a>    <span class="st">&#39;model_function&#39;</span>: <span class="st">&#39;rf-gp&#39;</span>,</span>
<span id="cb5-4"><a href="#cb5-4"></a>    <span class="st">&#39;name_target&#39;</span>: <span class="st">&#39;soil_moisture&#39;</span>,</span>
<span id="cb5-5"><a href="#cb5-5"></a>    <span class="st">&#39;list_t_pred&#39;</span>: [<span class="dv">1</span>, <span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">90</span>, <span class="dv">120</span>],  <span class="co"># Days after planting</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>    <span class="st">&#39;integrate_block&#39;</span>: <span class="va">True</span>  <span class="co"># Use block averaging</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Run the spatial-temporal workflow</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="im">from</span> soilmod_predict_st <span class="im">import</span> main  </span>
<span id="cb6-3"><a href="#cb6-3"></a>main(<span class="st">&#39;settings_moisture_timeseries.yaml&#39;</span>)</span></code></pre></div>
<p><strong>What you get</strong>: A series of soil moisture maps for each time point, allowing you to see how moisture patterns evolve across your field throughout the growing season.</p>
<h2 id="what-happens-under-the-hood">What Happens Under the Hood</h2>
<p>When you run a prediction workflow, here‚Äôs the step-by-step process that occurs:</p>
<div class="mermaid">sequenceDiagram
    participant User
    participant Workflow as Prediction Workflow
    participant Preprocessor as Data Preprocessor
    participant Model as ML Model
    participant Spatial as Spatial Engine

    User-&gt;&gt;Workflow: Run prediction workflow
    Workflow-&gt;&gt;Preprocessor: Load and clean data
    Preprocessor-&gt;&gt;Workflow: Return processed data
    Workflow-&gt;&gt;Model: Train prediction model
    Model-&gt;&gt;Workflow: Return trained model
    Workflow-&gt;&gt;Spatial: Generate spatial predictions
    Spatial-&gt;&gt;User: Output maps and uncertainties</div>
<p>Let‚Äôs break this down:</p>
<ol type="1">
<li><p><strong>Data Loading and Validation</strong>: The workflow first loads your soil measurements and covariate data, checking for missing values and coordinate system consistency.</p></li>
<li><p><strong>Preprocessing</strong>: The <a href="03_data_preprocessing_pipeline.md">Data Preprocessing Pipeline</a> cleans your data, handles outliers, and prepares features for modeling.</p></li>
<li><p><strong>Model Training</strong>: Depending on your choice, the system trains either <a href="04_mean_function_models___.html">Mean Function Models</a> (like Random Forest) or <a href="05_gaussian_process_models.md">Gaussian Process Models</a> to learn relationships between soil properties and environmental factors.</p></li>
<li><p><strong>Spatial Prediction</strong>: The trained model generates predictions across your study area, using the <a href="07_spatial_temporal_modeling_framework.md">Spatial-Temporal Modeling Framework</a> to handle geographic relationships.</p></li>
<li><p><strong>Uncertainty Quantification</strong>: The <a href="06_uncertainty_quantification_system.md">Uncertainty Quantification System</a> calculates prediction confidence intervals and maps areas of high/low uncertainty.</p></li>
</ol>
<h2 id="implementation-details">Implementation Details</h2>
<p>Each prediction workflow is implemented as a specialized Python module that orchestrates the complete modeling process. Here‚Äôs how the core prediction engine works:</p>
<h3 id="workflow-selection-logic">Workflow Selection Logic</h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">def</span> select_workflow_type(settings):</span>
<span id="cb8-2"><a href="#cb8-2"></a>    <span class="co">&quot;&quot;&quot;Choose appropriate workflow based on settings&quot;&quot;&quot;</span></span>
<span id="cb8-3"><a href="#cb8-3"></a>    <span class="cf">if</span> <span class="bu">len</span>(settings.list_z_pred) <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb8-4"><a href="#cb8-4"></a>        <span class="cf">return</span> <span class="st">&#39;static&#39;</span>  <span class="co"># Single time point</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>    <span class="cf">elif</span> <span class="bu">len</span>(settings.list_z_pred) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb8-6"><a href="#cb8-6"></a>        <span class="cf">return</span> <span class="st">&#39;change&#39;</span>  <span class="co"># Two time points for comparison  </span></span>
<span id="cb8-7"><a href="#cb8-7"></a>    <span class="cf">else</span>:</span>
<span id="cb8-8"><a href="#cb8-8"></a>        <span class="cf">return</span> <span class="st">&#39;spatial_temporal&#39;</span>  <span class="co"># Multiple time points</span></span></code></pre></div>
<p>This simple logic routes your analysis to the appropriate specialized workflow based on how many time points you want to analyze.</p>
<h3 id="model-training-and-prediction">Model Training and Prediction</h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Train the mean function (Random Forest or Bayesian Linear Regression)</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="cf">if</span> mean_function <span class="op">==</span> <span class="st">&#39;rf&#39;</span>:</span>
<span id="cb9-3"><a href="#cb9-3"></a>    rf_model <span class="op">=</span> rf.rf_train(X_train, y_train)</span>
<span id="cb9-4"><a href="#cb9-4"></a>    y_pred_mean, noise_pred <span class="op">=</span> rf.rf_predict(X_test, rf_model)</span>
<span id="cb9-5"><a href="#cb9-5"></a>    </span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="co"># Add Gaussian Process for spatial modeling (if selected)</span></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="cf">if</span> <span class="kw">not</span> calc_mean_only:</span>
<span id="cb9-8"><a href="#cb9-8"></a>    gp_pred, gp_uncertainty <span class="op">=</span> gp.train_predict_3D(</span>
<span id="cb9-9"><a href="#cb9-9"></a>        points3D_train, points3D_pred, </span>
<span id="cb9-10"><a href="#cb9-10"></a>        y_residuals, noise_train, gp_params</span>
<span id="cb9-11"><a href="#cb9-11"></a>    )</span></code></pre></div>
<p>This two-stage approach first learns the main relationships using machine learning, then uses Gaussian Processes to model spatial patterns in the residuals.</p>
<h3 id="spatial-integration">Spatial Integration</h3>
<p>For different spatial support (points, blocks, or polygons), the workflows use different aggregation strategies:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># For block predictions - average over multiple points</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="cf">if</span> settings.integrate_block:</span>
<span id="cb10-3"><a href="#cb10-3"></a>    block_mean, block_std <span class="op">=</span> averagestats(point_predictions, covariance_matrix)</span>
<span id="cb10-4"><a href="#cb10-4"></a>    </span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="co"># For point predictions - direct mapping</span></span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="cf">else</span>:</span>
<span id="cb10-7"><a href="#cb10-7"></a>    prediction_map <span class="op">=</span> align_nearest_neighbor(grid_coords, predictions)</span></code></pre></div>
<p>This ensures your predictions match the spatial resolution and support you need for your specific application.</p>
<h3 id="output-generation">Output Generation</h3>
<p>All workflows automatically generate: - <strong>Prediction maps</strong> as both images (PNG) and GIS files (GeoTIFF) - <strong>Uncertainty maps</strong> showing prediction confidence - <strong>Summary statistics</strong> for model performance assessment - <strong>Visualization plots</strong> for immediate interpretation</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Save results in multiple formats</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>array2geotiff(prediction_map, coordinates, resolution, </span>
<span id="cb11-3"><a href="#cb11-3"></a>              output_file <span class="op">+</span> <span class="st">&#39;.tif&#39;</span>, projection)</span>
<span id="cb11-4"><a href="#cb11-4"></a>plt.savefig(output_file <span class="op">+</span> <span class="st">&#39;.png&#39;</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb11-5"><a href="#cb11-5"></a>np.savetxt(output_file <span class="op">+</span> <span class="st">&#39;.txt&#39;</span>, prediction_values)</span></code></pre></div>
<h2 id="benefits-of-specialized-workflows">Benefits of Specialized Workflows</h2>
<p>Each workflow is optimized for its specific use case:</p>
<ul>
<li><strong>Static workflows</strong> focus on producing the most accurate single-time maps with detailed uncertainty analysis</li>
<li><strong>Change workflows</strong> emphasize proper statistical testing and significance of temporal differences<br />
</li>
<li><strong>Spatial-temporal workflows</strong> efficiently handle large datasets across multiple time points</li>
</ul>
<p>This specialization means you get better results faster, without having to worry about configuring complex modeling parameters for each scenario.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Prediction Workflows are the specialized engines that power AgReFed-ML‚Äôs soil modeling capabilities. Like having the right camera mode for different photography scenarios, these workflows ensure you‚Äôre using the optimal approach for your specific agricultural question.</p>
<p>Whether you need a single snapshot of soil conditions, want to track changes over time, or require dynamic spatial-temporal predictions, there‚Äôs a workflow designed specifically for your needs. The workflows handle all the complex data processing, model training, and spatial prediction generation automatically, while giving you complete control over the modeling approach through simple configuration files.</p>
<p>Ready to dive deeper into how your data gets prepared for these workflows? The next chapter covers the <a href="03_data_preprocessing_pipeline.md">Data Preprocessing Pipeline</a>, where we‚Äôll explore how AgReFed-ML transforms your raw soil measurements into analysis-ready datasets.</p>
<hr />
</body>
</html>
