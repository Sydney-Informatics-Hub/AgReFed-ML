<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>07 Spatial Temporal Modeling Framework</title>
  <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style>
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->

  <style>
    .mermaid {
      text-align: center;
      margin: 20px 0;
    }
    
    pre code.language-mermaid {
      background: transparent !important;
      border: none !important;
      padding: 0 !important;
    }
    
    pre.mermaid {
      background: transparent !important;
      border: none !important;
      text-align: center;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: 'default',
      securityLevel: 'loose',
      fontFamily: 'Arial, sans-serif'
    });
  </script>
</head>
<body>

<div id="navigation-sidebar" style="
    position: fixed;
    top: 0;
    left: 0;
    width: 280px;
    height: 100vh;
    background: #f8f9fa;
    border-right: 1px solid #a2a9b1;
    box-shadow: 2px 0 5px rgba(0,0,0,0.1);
    z-index: 1000;
    overflow-y: auto;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Liberation Sans', sans-serif;
    font-size: 14px;
    line-height: 1.6;
">
    <div style="
        background: #eaecf0;
        padding: 15px 20px;
        border-bottom: 1px solid #a2a9b1;
        position: sticky;
        top: 0;
        z-index: 1001;
    ">
        <h3 style="
            margin: 0;
            font-size: 16px;
            font-weight: 600;
            color: #000;
            display: flex;
            align-items: center;
            gap: 8px;
        ">
            üìö <span>Contents</span>
        </h3>
    </div>
    
    <nav style="padding: 15px 0;">
        <!-- Home/Overview Link -->
        <div style="padding: 0 0 10px 0; border-bottom: 1px solid #eee; margin-bottom: 10px;">
            <a href="index.html" style="
                display: flex;
                align-items: center;
                gap: 8px;
                padding: 8px 20px;
                color: #0645ad;
                text-decoration: none;
                border-left: 4px solid transparent;
                transition: all 0.2s ease;
                font-weight: 500;
            " 
            onmouseover="
                this.style.background='#eaf3ff'; 
                this.style.borderLeft='4px solid #0645ad';
                this.style.color='#0b3c5d';
            " 
            onmouseout="
                this.style.background='transparent'; 
                this.style.borderLeft='4px solid transparent';
                this.style.color='#0645ad';
            ">
                <span style="font-size: 16px;">üè†</span>
                <span>Overview</span>
            </a>
        </div>
        
        <ul style="
            list-style: none;
            margin: 0;
            padding: 0;
        ">
            <li style="margin: 0;">
                <a href="01_notebook_based_workflows_.html" style="
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    padding: 10px 20px;
                    color: #0645ad;
                    text-decoration: none;
                    border-left: 4px solid transparent;
                    transition: all 0.2s ease;
                " 
                onmouseover="
                    this.style.background='#eaf3ff'; 
                    this.style.borderLeft='4px solid #0645ad';
                    this.style.color='#0b3c5d';
                " 
                onmouseout="
                    this.style.background='transparent'; 
                    this.style.borderLeft='4px solid transparent';
                    this.style.color='#0645ad';
                ">
                    <span style="
                        background: #f0f0f0;
                        color: #555;
                        border-radius: 12px;
                        padding: 2px 8px;
                        font-size: 12px;
                        font-weight: 500;
                        min-width: 20px;
                        text-align: center;
                    ">1</span>
                    <span style="flex: 1;">Notebook-Based Workflows</span>
                </a>
            </li>
            <li style="margin: 0;">
                <a href="02_prediction_workflows_.html" style="
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    padding: 10px 20px;
                    color: #0645ad;
                    text-decoration: none;
                    border-left: 4px solid transparent;
                    transition: all 0.2s ease;
                " 
                onmouseover="
                    this.style.background='#eaf3ff'; 
                    this.style.borderLeft='4px solid #0645ad';
                    this.style.color='#0b3c5d';
                " 
                onmouseout="
                    this.style.background='transparent'; 
                    this.style.borderLeft='4px solid transparent';
                    this.style.color='#0645ad';
                ">
                    <span style="
                        background: #f0f0f0;
                        color: #555;
                        border-radius: 12px;
                        padding: 2px 8px;
                        font-size: 12px;
                        font-weight: 500;
                        min-width: 20px;
                        text-align: center;
                    ">2</span>
                    <span style="flex: 1;">Prediction Workflows</span>
                </a>
            </li>
            <li style="margin: 0;">
                <a href="03_data_preprocessing_pipeline_.html" style="
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    padding: 10px 20px;
                    color: #0645ad;
                    text-decoration: none;
                    border-left: 4px solid transparent;
                    transition: all 0.2s ease;
                " 
                onmouseover="
                    this.style.background='#eaf3ff'; 
                    this.style.borderLeft='4px solid #0645ad';
                    this.style.color='#0b3c5d';
                " 
                onmouseout="
                    this.style.background='transparent'; 
                    this.style.borderLeft='4px solid transparent';
                    this.style.color='#0645ad';
                ">
                    <span style="
                        background: #f0f0f0;
                        color: #555;
                        border-radius: 12px;
                        padding: 2px 8px;
                        font-size: 12px;
                        font-weight: 500;
                        min-width: 20px;
                        text-align: center;
                    ">3</span>
                    <span style="flex: 1;">Data Preprocessing Pipeline</span>
                </a>
            </li>
            <li style="margin: 0;">
                <a href="04_mean_function_models___.html" style="
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    padding: 10px 20px;
                    color: #0645ad;
                    text-decoration: none;
                    border-left: 4px solid transparent;
                    transition: all 0.2s ease;
                " 
                onmouseover="
                    this.style.background='#eaf3ff'; 
                    this.style.borderLeft='4px solid #0645ad';
                    this.style.color='#0b3c5d';
                " 
                onmouseout="
                    this.style.background='transparent'; 
                    this.style.borderLeft='4px solid transparent';
                    this.style.color='#0645ad';
                ">
                    <span style="
                        background: #f0f0f0;
                        color: #555;
                        border-radius: 12px;
                        padding: 2px 8px;
                        font-size: 12px;
                        font-weight: 500;
                        min-width: 20px;
                        text-align: center;
                    ">4</span>
                    <span style="flex: 1;">Mean Function Models</span>
                </a>
            </li>
            <li style="margin: 0;">
                <a href="05_gaussian_process_models_.html" style="
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    padding: 10px 20px;
                    color: #0645ad;
                    text-decoration: none;
                    border-left: 4px solid transparent;
                    transition: all 0.2s ease;
                " 
                onmouseover="
                    this.style.background='#eaf3ff'; 
                    this.style.borderLeft='4px solid #0645ad';
                    this.style.color='#0b3c5d';
                " 
                onmouseout="
                    this.style.background='transparent'; 
                    this.style.borderLeft='4px solid transparent';
                    this.style.color='#0645ad';
                ">
                    <span style="
                        background: #f0f0f0;
                        color: #555;
                        border-radius: 12px;
                        padding: 2px 8px;
                        font-size: 12px;
                        font-weight: 500;
                        min-width: 20px;
                        text-align: center;
                    ">5</span>
                    <span style="flex: 1;">Gaussian Process Models</span>
                </a>
            </li>
            <li style="margin: 0;">
                <a href="06_uncertainty_quantification_system_.html" style="
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    padding: 10px 20px;
                    color: #0645ad;
                    text-decoration: none;
                    border-left: 4px solid transparent;
                    transition: all 0.2s ease;
                " 
                onmouseover="
                    this.style.background='#eaf3ff'; 
                    this.style.borderLeft='4px solid #0645ad';
                    this.style.color='#0b3c5d';
                " 
                onmouseout="
                    this.style.background='transparent'; 
                    this.style.borderLeft='4px solid transparent';
                    this.style.color='#0645ad';
                ">
                    <span style="
                        background: #f0f0f0;
                        color: #555;
                        border-radius: 12px;
                        padding: 2px 8px;
                        font-size: 12px;
                        font-weight: 500;
                        min-width: 20px;
                        text-align: center;
                    ">6</span>
                    <span style="flex: 1;">Uncertainty Quantification System</span>
                </a>
            </li>
            <li style="
                margin: 0;
                background: #0645ad;
                background: linear-gradient(90deg, #0645ad 0%, #0b7ec8 100%);
                border-left: 4px solid #0645ad;
            ">
                <div style="
                    padding: 10px 20px;
                    color: white;
                    font-weight: 600;
                    display: flex;
                    align-items: center;
                    gap: 8px;
                ">
                    <span style="
                        background: rgba(255,255,255,0.2);
                        color: white;
                        border-radius: 12px;
                        padding: 2px 8px;
                        font-size: 12px;
                        font-weight: 500;
                        min-width: 20px;
                        text-align: center;
                    ">7</span>
                    <span style="flex: 1;">Spatial-Temporal Modeling Framework</span>
                    <span style="color: #ffd700;">‚óè</span>
                </div>
            </li>
            <li style="margin: 0;">
                <a href="08_synthetic_data_generation_.html" style="
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    padding: 10px 20px;
                    color: #0645ad;
                    text-decoration: none;
                    border-left: 4px solid transparent;
                    transition: all 0.2s ease;
                " 
                onmouseover="
                    this.style.background='#eaf3ff'; 
                    this.style.borderLeft='4px solid #0645ad';
                    this.style.color='#0b3c5d';
                " 
                onmouseout="
                    this.style.background='transparent'; 
                    this.style.borderLeft='4px solid transparent';
                    this.style.color='#0645ad';
                ">
                    <span style="
                        background: #f0f0f0;
                        color: #555;
                        border-radius: 12px;
                        padding: 2px 8px;
                        font-size: 12px;
                        font-weight: 500;
                        min-width: 20px;
                        text-align: center;
                    ">8</span>
                    <span style="flex: 1;">Synthetic Data Generation</span>
                </a>
            </li>
            <li style="margin: 0;">
                <a href="09_model_evaluation_and_cross_validation_.html" style="
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    padding: 10px 20px;
                    color: #0645ad;
                    text-decoration: none;
                    border-left: 4px solid transparent;
                    transition: all 0.2s ease;
                " 
                onmouseover="
                    this.style.background='#eaf3ff'; 
                    this.style.borderLeft='4px solid #0645ad';
                    this.style.color='#0b3c5d';
                " 
                onmouseout="
                    this.style.background='transparent'; 
                    this.style.borderLeft='4px solid transparent';
                    this.style.color='#0645ad';
                ">
                    <span style="
                        background: #f0f0f0;
                        color: #555;
                        border-radius: 12px;
                        padding: 2px 8px;
                        font-size: 12px;
                        font-weight: 500;
                        min-width: 20px;
                        text-align: center;
                    ">9</span>
                    <span style="flex: 1;">Model Evaluation and Cross-Validation</span>
                </a>
            </li>
        </ul>
    </nav>
</div>

<style>
/* Force content spacing with aggressive selectors */
html, body {
    margin: 0 !important;
    padding: 0 !important;
}

body {
    padding-left: 340px !important;  /* Sidebar (280px) + generous padding (60px) */
    padding-right: 60px !important;  /* Matching right padding */
    margin: 0 !important;
    box-sizing: border-box !important;
}

/* Target all possible content containers */
body > *, 
main, article, section, .content, 
#content, .main-content, .page-content,
body > div, body > header, body > nav:not(#navigation-sidebar) {
    margin-left: 0 !important;
    padding-left: 0 !important;
    max-width: none !important;
}

/* Ensure headings have proper spacing from sidebar */
h1, h2, h3, h4, h5, h6 {
    margin-top: 2em !important;
    margin-bottom: 1em !important;
    line-height: 1.3 !important;
}

/* Better paragraph and content spacing */
p, div, ul, ol, blockquote, pre {
    margin-bottom: 1.5em !important;
    line-height: 1.6 !important;
}

/* Handle wide content like code blocks and tables */
pre, table, .mermaid, code {
    max-width: calc(100vw - 420px) !important; /* Account for all spacing */
    overflow-x: auto !important;
    margin: 1.5em 0 !important;
}

/* Responsive design */
@media (max-width: 1200px) {
    body {
        padding-left: 320px !important; /* Slightly less padding on medium screens */
        padding-right: 40px !important;
    }
    
    pre, table, .mermaid, code {
        max-width: calc(100vw - 380px) !important;
    }
}

@media (max-width: 768px) {
    #navigation-sidebar {
        width: 250px;
    }
    body {
        padding-left: 290px !important; /* Sidebar (250px) + padding (40px) */
        padding-right: 30px !important;
    }
    
    pre, table, .mermaid, code {
        max-width: calc(100vw - 340px) !important;
    }
}

@media (max-width: 600px) {
    #navigation-sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
    }
    #navigation-sidebar:hover,
    #navigation-sidebar:focus-within {
        transform: translateX(0);
    }
    body {
        padding-left: 20px !important;
        padding-right: 20px !important;
    }
    
    pre, table, .mermaid, code {
        max-width: calc(100vw - 60px) !important;
    }
    
    /* Mobile menu button */
    #navigation-sidebar::before {
        content: "‚ò∞ Contents";
        position: fixed;
        top: 10px;
        left: 10px;
        background: #0645ad;
        color: white;
        padding: 8px 12px;
        border-radius: 4px;
        font-size: 14px;
        cursor: pointer;
        z-index: 1002;
        box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
}

/* Print styles */
@media print {
    #navigation-sidebar {
        display: none !important;
    }
    body {
        padding-left: 2cm !important;
        padding-right: 2cm !important;
    }
    
    pre, table, .mermaid {
        max-width: 100% !important;
    }
}
</style>

<header id="title-block-header">
<h1 class="title">07 Spatial Temporal Modeling Framework</h1>
</header>
<h1 id="chapter-7-spatial-temporal-modeling-framework">Chapter 7: Spatial-Temporal Modeling Framework</h1>
<p>Now that you‚Äôve learned how the <a href="06_uncertainty_quantification_system.md">Uncertainty Quantification System</a> provides comprehensive confidence intervals for your soil predictions, it‚Äôs time to explore AgReFed-ML‚Äôs most sophisticated capability: the <strong>Spatial-Temporal Modeling Framework</strong>.</p>
<p>Think of this relationship like the difference between taking a single photograph and creating a time-lapse movie. The <a href="06_uncertainty_quantification_system.md">Uncertainty Quantification System</a> is like having a professional photographer who can take an excellent snapshot of your field with honest assessments of image quality. But the Spatial-Temporal Modeling Framework is like having a filmmaker who can create a smooth, detailed time-lapse movie showing how your field changes throughout an entire growing season - complete with confidence intervals for every frame.</p>
<h2 id="what-problem-does-the-spatial-temporal-modeling-framework-solve">What Problem Does the Spatial-Temporal Modeling Framework Solve?</h2>
<p>Imagine you‚Äôre managing irrigation for a 500-hectare farm during a critical growing season. You need to make weekly decisions about where and when to irrigate, but soil moisture changes constantly based on:</p>
<ul>
<li><strong>Weather patterns</strong>: Rainfall events, drought periods, temperature fluctuations</li>
<li><strong>Crop growth</strong>: Root development changes water uptake patterns over time</li>
<li><strong>Seasonal cycles</strong>: Spring snowmelt, summer heat, autumn harvest</li>
<li><strong>Spatial variation</strong>: Different soil types, slopes, and microclimates across your farm</li>
</ul>
<p>With previous modeling approaches, you‚Äôd face these limitations:</p>
<ul>
<li><strong>Static snapshots</strong>: Models that predict soil moisture for only one point in time</li>
<li><strong>Temporal blindness</strong>: Missing the smooth transitions and seasonal patterns</li>
<li><strong>Disconnected predictions</strong>: No understanding of how this week‚Äôs moisture relates to next week‚Äôs</li>
<li><strong>Poor interpolation</strong>: Unrealistic jumps between weekly measurements</li>
</ul>
<p>The Spatial-Temporal Modeling Framework solves these problems by modeling soil properties as they naturally exist: <strong>continuously varying across both space and time simultaneously</strong>. It‚Äôs like having a sophisticated weather forecasting system specifically designed for soil properties.</p>
<h2 id="what-is-the-spatial-temporal-modeling-framework">What Is the Spatial-Temporal Modeling Framework?</h2>
<p>Think of the Spatial-Temporal Modeling Framework as a smart 4D mapping system (3D space + time) that understands three fundamental principles:</p>
<h3 id="spatial-correlation---nearby-places-are-similar">1. <strong>Spatial Correlation</strong> - ‚ÄúNearby Places Are Similar‚Äù</h3>
<p>Locations close to each other should have similar soil properties, just like neighboring pixels in a photograph should have similar colors.</p>
<h3 id="temporal-correlation---nearby-times-are-similar">2. <strong>Temporal Correlation</strong> - ‚ÄúNearby Times Are Similar‚Äù</h3>
<p>Soil conditions this week should be similar to conditions next week, just like consecutive frames in a movie should look similar.</p>
<h3 id="spatial-temporal-correlation---the-whole-story-matters">3. <strong>Spatial-Temporal Correlation</strong> - ‚ÄúThe Whole Story Matters‚Äù</h3>
<p>The framework understands that a location with high soil moisture today will influence moisture patterns at nearby locations over the coming weeks.</p>
<h2 id="key-components-of-the-spatial-temporal-framework">Key Components of the Spatial-Temporal Framework</h2>
<p>The framework has three essential components working together:</p>
<h3 id="d-kernel-functions-the-spatial-temporal-rules">1. <strong>3D Kernel Functions (The Spatial-Temporal Rules)</strong></h3>
<p>These mathematical functions define how correlation works across all dimensions:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># The kernel considers three dimensions simultaneously:</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>correlation <span class="op">=</span> spatial_temporal_kernel(</span>
<span id="cb1-3"><a href="#cb1-3"></a>    distance_xy,    <span class="co"># How far apart in space (meters)</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>    distance_z,     <span class="co"># How far apart in depth (meters) </span></span>
<span id="cb1-5"><a href="#cb1-5"></a>    distance_time   <span class="co"># How far apart in time (days/months)</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>)</span></code></pre></div>
<p>This kernel might say: ‚Äúlocations 100 meters apart and 7 days apart should have correlation of 0.8, but locations 1 kilometer apart and 30 days apart should have correlation of 0.2.‚Äù</p>
<h3 id="temporal-coordinate-system-time-as-a-dimension">2. <strong>Temporal Coordinate System (Time as a Dimension)</strong></h3>
<p>Time is treated as a coordinate just like x, y, and depth:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Each measurement has 4 coordinates</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>sample_location <span class="op">=</span> {</span>
<span id="cb2-3"><a href="#cb2-3"></a>    <span class="st">&#39;x&#39;</span>: <span class="fl">1234.5</span>,        <span class="co"># Easting (meters)</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>    <span class="st">&#39;y&#39;</span>: <span class="fl">5678.9</span>,        <span class="co"># Northing (meters)  </span></span>
<span id="cb2-5"><a href="#cb2-5"></a>    <span class="st">&#39;depth&#39;</span>: <span class="fl">0.1</span>,       <span class="co"># Depth (meters)</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>    <span class="st">&#39;time&#39;</span>: <span class="dv">150</span>         <span class="co"># Days after planting</span></span>
<span id="cb2-7"><a href="#cb2-7"></a>}</span></code></pre></div>
<h3 id="continuous-prediction-surface-the-4d-map">3. <strong>Continuous Prediction Surface (The 4D Map)</strong></h3>
<p>The framework generates smooth predictions across all four dimensions:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Predict soil moisture for any location and any time</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>prediction <span class="op">=</span> predict_spatial_temporal(</span>
<span id="cb3-3"><a href="#cb3-3"></a>    location<span class="op">=</span>[<span class="fl">1250.0</span>, <span class="fl">5700.0</span>, <span class="fl">0.1</span>],  <span class="co"># x, y, depth</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>    time_points<span class="op">=</span>[<span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">150</span>, <span class="dv">200</span>]  <span class="co"># Multiple time points</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>)</span></code></pre></div>
<h2 id="how-to-use-the-spatial-temporal-modeling-framework">How to Use the Spatial-Temporal Modeling Framework</h2>
<p>Let‚Äôs walk through creating a soil moisture monitoring system for a growing season. This will show you how to predict soil moisture at any location and any time across your farm.</p>
<h3 id="step-1-configure-your-temporal-analysis">Step 1: Configure Your Temporal Analysis</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># Settings for soil moisture monitoring across growing season</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>settings <span class="op">=</span> {</span>
<span id="cb4-3"><a href="#cb4-3"></a>    <span class="st">&#39;model_function&#39;</span>: <span class="st">&#39;rf-gp&#39;</span>,           <span class="co"># Random Forest + Gaussian Process</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>    <span class="st">&#39;name_target&#39;</span>: <span class="st">&#39;soil_moisture&#39;</span>,      <span class="co"># What we&#39;re predicting</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>    <span class="st">&#39;colname_tcoord&#39;</span>: <span class="st">&#39;days_after_planting&#39;</span>,  <span class="co"># Time coordinate column</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>    <span class="st">&#39;tmin&#39;</span>: <span class="dv">0</span>,                           <span class="co"># Start of growing season</span></span>
<span id="cb4-7"><a href="#cb4-7"></a>    <span class="st">&#39;tmax&#39;</span>: <span class="dv">180</span>,                         <span class="co"># End of growing season  </span></span>
<span id="cb4-8"><a href="#cb4-8"></a>    <span class="st">&#39;list_t_pred&#39;</span>: [<span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">90</span>, <span class="dv">120</span>, <span class="dv">150</span>]  <span class="co"># Key time points to predict</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>}</span></code></pre></div>
<p>This tells the framework you want to predict soil moisture at 30-day intervals throughout a 180-day growing season.</p>
<h3 id="step-2-run-the-spatial-temporal-workflow">Step 2: Run the Spatial-Temporal Workflow</h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="im">from</span> soilmod_predict_st <span class="im">import</span> main</span>
<span id="cb5-2"><a href="#cb5-2"></a></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co"># Run the complete spatial-temporal analysis</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>main(<span class="st">&#39;settings_moisture_timeseries.yaml&#39;</span>)</span></code></pre></div>
<p>This single command runs the entire framework, generating soil moisture maps for each time point with full uncertainty quantification.</p>
<h3 id="step-3-examine-your-time-series-maps">Step 3: Examine Your Time-Series Maps</h3>
<p>The framework automatically creates: - <strong>Individual time-slice maps</strong>: Soil moisture predictions for each time point - <strong>Animation sequences</strong>: Time-lapse visualization of moisture changes - <strong>Uncertainty evolution</strong>: How prediction confidence changes over time</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># The framework generates these outputs automatically:</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="co"># - Pred_soil_moisture_t030.tif  (Day 30 predictions)</span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co"># - Pred_soil_moisture_t060.tif  (Day 60 predictions)</span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co"># - Pred_soil_moisture_t090.tif  (Day 90 predictions)</span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="co"># - Std_soil_moisture_t030.tif   (Day 30 uncertainties)</span></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="co"># - ... and so on for all time points</span></span></code></pre></div>
<h2 id="what-happens-under-the-hood">What Happens Under the Hood</h2>
<p>When you run the Spatial-Temporal Modeling Framework, here‚Äôs the step-by-step process that occurs behind the scenes:</p>
<div class="mermaid">sequenceDiagram
    participant User
    participant Framework as ST Framework
    participant MeanFunc as Mean Function Models
    participant GP3D as 3D Gaussian Process
    participant TimeSlice as Time Slice Generator

    User-&gt;&gt;Framework: Run spatial-temporal prediction
    Framework-&gt;&gt;MeanFunc: Train temporal mean functions
    MeanFunc-&gt;&gt;Framework: Return baseline predictions
    Framework-&gt;&gt;GP3D: Train 3D+time GP model
    GP3D-&gt;&gt;Framework: Return spatial-temporal correlations
    Framework-&gt;&gt;TimeSlice: Generate predictions for each time
    TimeSlice-&gt;&gt;User: Output time-series maps</div>
<p>Let‚Äôs break this down:</p>
<h3 id="temporal-coordinate-processing">1. <strong>Temporal Coordinate Processing</strong></h3>
<p>The framework first converts your time information into a coordinate system:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># Convert time measurements to coordinates</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="kw">def</span> process_temporal_coordinates(data):</span>
<span id="cb8-3"><a href="#cb8-3"></a>    <span class="co"># Time becomes the &#39;z&#39; coordinate in 3D space</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>    data[<span class="st">&#39;z&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;days_after_planting&#39;</span>]  </span>
<span id="cb8-5"><a href="#cb8-5"></a>    </span>
<span id="cb8-6"><a href="#cb8-6"></a>    <span class="co"># Create 3D points: [time, y_position, x_position]</span></span>
<span id="cb8-7"><a href="#cb8-7"></a>    points_3D <span class="op">=</span> np.array([</span>
<span id="cb8-8"><a href="#cb8-8"></a>        data[<span class="st">&#39;z&#39;</span>].values,     <span class="co"># Time dimension</span></span>
<span id="cb8-9"><a href="#cb8-9"></a>        data[<span class="st">&#39;y&#39;</span>].values,     <span class="co"># Spatial Y dimension  </span></span>
<span id="cb8-10"><a href="#cb8-10"></a>        data[<span class="st">&#39;x&#39;</span>].values      <span class="co"># Spatial X dimension</span></span>
<span id="cb8-11"><a href="#cb8-11"></a>    ]).T</span>
<span id="cb8-12"><a href="#cb8-12"></a>    </span>
<span id="cb8-13"><a href="#cb8-13"></a>    <span class="cf">return</span> points_3D</span></code></pre></div>
<p>This allows the GP model to treat time as a spatial dimension and learn temporal correlations.</p>
<h3 id="mean-function-training-across-time">2. <strong>Mean Function Training Across Time</strong></h3>
<p>The framework trains <a href="04_mean_function_models___.html">Mean Function Models</a> that understand temporal patterns:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Add temporal features to environmental covariates</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>temporal_features <span class="op">=</span> base_features <span class="op">+</span> [<span class="st">&#39;days_after_planting&#39;</span>]</span>
<span id="cb9-3"><a href="#cb9-3"></a></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="co"># Train Random Forest that learns seasonal patterns</span></span>
<span id="cb9-5"><a href="#cb9-5"></a>rf_model <span class="op">=</span> train_temporal_model(</span>
<span id="cb9-6"><a href="#cb9-6"></a>    X<span class="op">=</span>environmental_data_plus_time,</span>
<span id="cb9-7"><a href="#cb9-7"></a>    y<span class="op">=</span>soil_moisture_measurements,</span>
<span id="cb9-8"><a href="#cb9-8"></a>    features<span class="op">=</span>temporal_features</span>
<span id="cb9-9"><a href="#cb9-9"></a>)</span></code></pre></div>
<p>This captures broad seasonal trends like ‚Äúsoil moisture decreases through summer and increases in fall.‚Äù</p>
<h3 id="d-gaussian-process-training">3. <strong>3D Gaussian Process Training</strong></h3>
<p>The framework trains a 3D Gaussian Process that learns spatial-temporal correlations:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># Train GP with 3D kernel (x, y, time)</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>gp_model <span class="op">=</span> train_3D_GP(</span>
<span id="cb10-3"><a href="#cb10-3"></a>    coordinates_3D<span class="op">=</span>sample_locations_with_time,</span>
<span id="cb10-4"><a href="#cb10-4"></a>    residuals<span class="op">=</span>measurements_minus_mean_function,</span>
<span id="cb10-5"><a href="#cb10-5"></a>    kernel_lengthscales<span class="op">=</span>[</span>
<span id="cb10-6"><a href="#cb10-6"></a>        time_correlation_days,    <span class="co"># How long temporal correlation lasts</span></span>
<span id="cb10-7"><a href="#cb10-7"></a>        spatial_correlation_xy,   <span class="co"># How far spatial correlation extends</span></span>
<span id="cb10-8"><a href="#cb10-8"></a>        depth_correlation_z       <span class="co"># How deep vertical correlation goes</span></span>
<span id="cb10-9"><a href="#cb10-9"></a>    ]</span>
<span id="cb10-10"><a href="#cb10-10"></a>)</span></code></pre></div>
<p>This learns patterns like ‚Äúhigh moisture at location A on day 50 suggests high moisture at nearby locations on days 48-52.‚Äù</p>
<h3 id="time-slice-prediction-generation">4. <strong>Time Slice Prediction Generation</strong></h3>
<p>For each time point you specified, the framework generates complete spatial maps:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">def</span> predict_time_slice(time_point):</span>
<span id="cb11-2"><a href="#cb11-2"></a>    <span class="co"># Get environmental conditions for all locations at this time</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>    environmental_grid_t <span class="op">=</span> get_environmental_data(time<span class="op">=</span>time_point)</span>
<span id="cb11-4"><a href="#cb11-4"></a>    </span>
<span id="cb11-5"><a href="#cb11-5"></a>    <span class="co"># Predict with mean function</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>    mean_predictions_t <span class="op">=</span> rf_model.predict(environmental_grid_t)</span>
<span id="cb11-7"><a href="#cb11-7"></a>    </span>
<span id="cb11-8"><a href="#cb11-8"></a>    <span class="co"># Add spatial-temporal GP corrections</span></span>
<span id="cb11-9"><a href="#cb11-9"></a>    gp_corrections_t <span class="op">=</span> gp_model.predict_at_time(time<span class="op">=</span>time_point)</span>
<span id="cb11-10"><a href="#cb11-10"></a>    </span>
<span id="cb11-11"><a href="#cb11-11"></a>    <span class="co"># Combine for final predictions</span></span>
<span id="cb11-12"><a href="#cb11-12"></a>    final_predictions_t <span class="op">=</span> mean_predictions_t <span class="op">+</span> gp_corrections_t</span>
<span id="cb11-13"><a href="#cb11-13"></a>    </span>
<span id="cb11-14"><a href="#cb11-14"></a>    <span class="cf">return</span> final_predictions_t, uncertainties_t</span></code></pre></div>
<p>This process creates smooth, realistic transitions between time points while honoring your actual measurements.</p>
<h2 id="implementation-details">Implementation Details</h2>
<p>The Spatial-Temporal Modeling Framework is implemented in <code>soilmod_predict_st.py</code> with several sophisticated components working together:</p>
<h3 id="temporal-settings-processing">Temporal Settings Processing</h3>
<p>The framework converts temporal settings to spatial-temporal coordinates:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw">def</span> preprocess_settings(fname_settings):</span>
<span id="cb12-2"><a href="#cb12-2"></a>    <span class="co">&quot;&quot;&quot;Convert temporal settings to 3D spatial settings&quot;&quot;&quot;</span></span>
<span id="cb12-3"><a href="#cb12-3"></a>    <span class="co"># Map temporal coordinates to z-coordinates for 3D processing</span></span>
<span id="cb12-4"><a href="#cb12-4"></a>    settings.colname_zcoord <span class="op">=</span> settings.colname_tcoord  <span class="co"># Time becomes &#39;z&#39;</span></span>
<span id="cb12-5"><a href="#cb12-5"></a>    settings.zmin <span class="op">=</span> settings.tmin                      <span class="co"># Time minimum</span></span>
<span id="cb12-6"><a href="#cb12-6"></a>    settings.zmax <span class="op">=</span> settings.tmax                      <span class="co"># Time maximum  </span></span>
<span id="cb12-7"><a href="#cb12-7"></a>    settings.list_z_pred <span class="op">=</span> settings.list_t_pred        <span class="co"># Prediction times</span></span>
<span id="cb12-8"><a href="#cb12-8"></a>    </span>
<span id="cb12-9"><a href="#cb12-9"></a>    <span class="cf">return</span> settings</span></code></pre></div>
<p>This allows the framework to reuse all the 3D Gaussian Process machinery for spatial-temporal analysis.</p>
<h3 id="temporal-correlation-modeling">Temporal Correlation Modeling</h3>
<p>The framework uses the same 3D sparse kernels from the <a href="05_gaussian_process_models.md">Gaussian Process Models</a> chapter, but applies them to spatial-temporal distances:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># 3D distance calculation includes temporal separation</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>points3D_train <span class="op">=</span> np.array([</span>
<span id="cb13-3"><a href="#cb13-3"></a>    temporal_coordinates,  <span class="co"># Days after planting</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>    y_coordinates,        <span class="co"># Northing positions</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>    x_coordinates         <span class="co"># Easting positions  </span></span>
<span id="cb13-6"><a href="#cb13-6"></a>]).T</span>
<span id="cb13-7"><a href="#cb13-7"></a></span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="co"># GP kernel calculates correlations in space-time</span></span>
<span id="cb13-9"><a href="#cb13-9"></a>correlations <span class="op">=</span> gpkernel_sparse_multidim(</span>
<span id="cb13-10"><a href="#cb13-10"></a>    distance_matrix_3D, </span>
<span id="cb13-11"><a href="#cb13-11"></a>    lengthscales<span class="op">=</span>[time_scale, spatial_scale_y, spatial_scale_x]</span>
<span id="cb13-12"><a href="#cb13-12"></a>)</span></code></pre></div>
<p>This creates correlation patterns that honor both spatial and temporal relationships simultaneously.</p>
<h3 id="time-slice-iteration">Time Slice Iteration</h3>
<p>The framework generates predictions by iterating through your specified time points:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># Generate predictions for each time slice</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="cf">for</span> time_point <span class="kw">in</span> settings.list_t_pred:</span>
<span id="cb14-3"><a href="#cb14-3"></a>    <span class="bu">print</span>(<span class="ss">f&#39;Computing predictions for time: </span><span class="sc">{</span>time_point<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb14-4"><a href="#cb14-4"></a>    </span>
<span id="cb14-5"><a href="#cb14-5"></a>    <span class="co"># Select grid data for this time point</span></span>
<span id="cb14-6"><a href="#cb14-6"></a>    grid_at_time <span class="op">=</span> covariate_grid[covariate_grid.time <span class="op">==</span> time_point]</span>
<span id="cb14-7"><a href="#cb14-7"></a>    </span>
<span id="cb14-8"><a href="#cb14-8"></a>    <span class="co"># Train/predict with spatial-temporal model</span></span>
<span id="cb14-9"><a href="#cb14-9"></a>    predictions, uncertainties <span class="op">=</span> predict_spatial_temporal(</span>
<span id="cb14-10"><a href="#cb14-10"></a>        training_data<span class="op">=</span>soil_samples_all_times,</span>
<span id="cb14-11"><a href="#cb14-11"></a>        prediction_grid<span class="op">=</span>grid_at_time,</span>
<span id="cb14-12"><a href="#cb14-12"></a>        time_point<span class="op">=</span>time_point</span>
<span id="cb14-13"><a href="#cb14-13"></a>    )</span>
<span id="cb14-14"><a href="#cb14-14"></a>    </span>
<span id="cb14-15"><a href="#cb14-15"></a>    <span class="co"># Save results as time-specific maps</span></span>
<span id="cb14-16"><a href="#cb14-16"></a>    save_time_slice_maps(predictions, uncertainties, time_point)</span></code></pre></div>
<p>This creates a complete set of maps showing how soil properties evolve over time.</p>
<h3 id="uncertainty-evolution-tracking">Uncertainty Evolution Tracking</h3>
<p>The framework tracks how uncertainty changes over time:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1"></a><span class="kw">def</span> calculate_temporal_uncertainty(distance_to_samples_in_time):</span>
<span id="cb15-2"><a href="#cb15-2"></a>    <span class="co">&quot;&quot;&quot;Calculate uncertainty based on temporal distance to measurements&quot;&quot;&quot;</span></span>
<span id="cb15-3"><a href="#cb15-3"></a>    </span>
<span id="cb15-4"><a href="#cb15-4"></a>    <span class="co"># Uncertainty increases with temporal distance from measurements</span></span>
<span id="cb15-5"><a href="#cb15-5"></a>    temporal_uncertainty <span class="op">=</span> base_uncertainty <span class="op">*</span> (</span>
<span id="cb15-6"><a href="#cb15-6"></a>        <span class="dv">1</span> <span class="op">+</span> temporal_decay_factor <span class="op">*</span> min_time_distance</span>
<span id="cb15-7"><a href="#cb15-7"></a>    )</span>
<span id="cb15-8"><a href="#cb15-8"></a>    </span>
<span id="cb15-9"><a href="#cb15-9"></a>    <span class="cf">return</span> temporal_uncertainty</span></code></pre></div>
<p>This ensures that predictions far from measurement times have appropriately higher uncertainty.</p>
<h2 id="benefits-for-agricultural-applications">Benefits for Agricultural Applications</h2>
<p>The Spatial-Temporal Modeling Framework provides essential capabilities for time-sensitive agricultural management:</p>
<ul>
<li><strong>Dynamic Management</strong>: Make informed decisions about irrigation, fertilization, and pest control based on how conditions are changing</li>
<li><strong>Seasonal Planning</strong>: Understand long-term trends and plan management activities accordingly</li>
<li><strong>Risk Assessment</strong>: Identify periods when soil conditions may be problematic and plan mitigation strategies</li>
<li><strong>Resource Optimization</strong>: Time inputs like irrigation and fertilizer application for maximum efficiency</li>
<li><strong>Monitoring Programs</strong>: Design sampling strategies that account for how soil properties change over time</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>The Spatial-Temporal Modeling Framework represents the pinnacle of AgReFed-ML‚Äôs predictive capabilities. Like having a sophisticated 4D weather forecasting system for soil properties, it enables you to understand and predict how soil conditions vary across your landscape and through time.</p>
<p>By combining the baseline predictions from <a href="04_mean_function_models___.html">Mean Function Models</a>, the spatial sophistication of <a href="05_gaussian_process_models.md">Gaussian Process Models</a>, and the uncertainty awareness of the <a href="06_uncertainty_quantification_system.md">Uncertainty Quantification System</a>, the framework creates smooth, realistic time-series predictions that honor both the spatial structure of your landscape and the temporal dynamics of agricultural systems.</p>
<p>These dynamic, uncertainty-aware predictions become the foundation for generating realistic training datasets and testing scenarios. Ready to explore how AgReFed-ML can create synthetic soil data that captures all these spatial-temporal relationships? The next chapter covers <a href="08_synthetic_data_generation.md">Synthetic Data Generation</a>, where you‚Äôll learn how the system can generate realistic soil datasets for testing models, filling data gaps, and training machine learning algorithms.</p>
<hr />
</body>
</html>
